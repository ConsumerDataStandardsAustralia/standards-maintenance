<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Draft-06: Financial-grade API - Part 2: Read and Write API Security Profile</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Financial-grade API - Part 2: Read and Write API Security Profile">
<meta name="generator" content="xml2rfc v1.36 (http://xml2rfc.ietf.org/)">
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: small; color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: small; font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: small; font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: small; text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Draft-06</td><td class="header">N. Sakimura</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">NRI</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">J. Bradley</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Yubico</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">E. Jay</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Illumila</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">October 17, 2018</td></tr>
</table></td></tr></table>
<h1><br />Financial-grade API - Part 2: Read and Write API Security Profile</h1>

<h3>Warning</h3>

<p>This document is not an OIDF International Standard. It is distributed for review and comment. It is subject to change without notice and may not be referred to as an International Standard.  
</p>
<p>Recipients of this draft are invited to submit, with their comments, notification of any relevant patent rights of which they are aware and to provide supporting documentation.  
</p>
<h3>Copyright notice &amp; license</h3>

<p>The OpenID Foundation (OIDF) grants to any Contributor, developer, implementer, or other interested party a non-exclusive, royalty free, worldwide copyright license to reproduce, prepare derivative works from, distribute, perform and display, this Implementers Draft or Final Specification solely for the purposes of (i) developing specifications, and (ii) implementing Implementers Drafts and Final Specifications based on such documents, provided that attribution be made to the OIDF as the source of the material, but that such attribution does not indicate an endorsement by the OIDF.
</p>
<p>The technology described in this specification was made available from contributions from various sources, including members of the OpenID Foundation and others. Although the OpenID Foundation has taken steps to help ensure that the technology is available for distribution, it takes no position regarding the validity or scope of any intellectual property or other rights that might be claimed to pertain to the implementation or use of the technology described in this specification or the extent to which any license under such rights might or might not be available; neither does it represent that it has made any independent effort to identify any such rights. The OpenID Foundation and the contributors to this specification make no (and hereby expressly disclaim any) warranties (express, implied, or otherwise), including implied warranties of merchantability, non-infringement, fitness for a particular purpose, or title, related to this specification, and the entire risk as to implementing this specification is assumed by the implementer. The OpenID Intellectual Property Rights policy requires contributors to offer a patent promise not to assert certain patent claims against other contributors and against implementers. The OpenID Foundation invites any interested party to bring to its attention any copyrights, patents, patent applications, or other proprietary rights that may cover technology that may be required to practice this specification.
</p>
<h3>Foreword</h3>

<p>The OpenID Foundation (OIDF) promotes, protects and nurtures the OpenID community and technologies. As a non-profit international standardizing body, it is comprised by over 160 participating entities (workgroup participants). The work of preparing implementer drafts and final international standards is carried out through OIDF workgroups in accordance with the OpenID Process. Participants interested in a subject for which a workgroup has been established has the right to be represented in that workgroup. International organizations, governmental and non-governmental, in liaison with OIDF, also take part in the work. OIDF collaborates closely with other standardizing bodies in the related fields.
</p>
<p>Final drafts adopted by the Workgroup through consensus are circulated publicly for the public review for 60 days and for the OIDF members for voting. Publication as an OIDF Standard requires approval by at least 50 % of the members casting a vote. There is a possibility that some of the elements of this document may be the subject to patent rights. OIDF shall not be held responsible for identifying any or all such patent rights.
</p>
<p>Financial-grade API consists of the following parts:
</p>
<p>
        </p>
<ul class="text">
<li>Part 1: Read-Only API Security Profile 
</li>
<li>Part 2: Read and Write API Security Profile 
</li>
<li>Client Initiated Backchannel Authentication Profile
</li>
</ul><p>
      
</p>
<p>Future parts may follow.
</p>
<p>These parts are intended to be used with [RFC6749], [RFC6750], [RFC7636], and [OIDC].
</p>
<h3>Introduction</h3>

<p>Fintech is an area of future economic growth around the world and Fintech organizations need to improve the security of their operations and protect customer data. It is common practice of aggregation services to use screen scraping as a method to capture data by storing users' passwords. This brittle, inefficient, and insecure practice creates security vulnerabilities which require financial institutions to allow what appears to be an automated attack against their applications and to maintain a whitelist of aggregators. A new draft standard, proposed by this workgroup would instead utilize an API model with structured data and a token model, such as OAuth [RFC6749, RFC6750].
</p>
<p>The Financial-grade API aims to provide specific implementation guidelines for online financial services to adopt by developing a REST/JSON data model protected by a highly secured OAuth profile. The Financial-grade API security profile can be applied to online services in any market area that requires a higher level of security than provided by standard OAuth or OpenID Connect.
</p>
<p>This document is Part 2 of FAPI that specifies the Financial-grade API and it provides a profile of OAuth that is suitable to be used in write access to financial data (also known as transaction access) and other similar higher risk access. This document specifies the controls against attacks such as: authorization request tampering, authorization response tampering including code injection, state injection, and token request phishing. Additional details are available in the security considerations section.
</p>
<p>Although it is possible to code an OpenID Provider and Relying Party from first principles using this specification, the main audience for this specification is parties who already have a certified implementation of OpenID Connect and want to achieve a higher level of security. Implementors are encouraged to understand the security considerations contained in section 7.6 before embarking on a 'from scratch' implementation.
</p>
<h3>Notational conventions</h3>

<p>The keywords "shall", "shall not", "should", "should not", "may", and "can" in this document are to be interpreted as described in ISO Directive Part 2 [ISODIR2]. These keywords are not used as dictionary terms such that any occurrence of them shall be interpreted as keywords and are not to be interpreted with their natural language meanings.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#scope">1.</a>&nbsp;
Scope<br />
<a href="#normative-references">2.</a>&nbsp;
Normative references<br />
<a href="#terms-and-definitions">3.</a>&nbsp;
Terms and definitions<br />
<a href="#symbols-and-abbreviated-terms">4.</a>&nbsp;
Symbols and Abbreviated terms<br />
<a href="#read-and-write-api-security-profile">5.</a>&nbsp;
Read and write API security profile<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#introduction">5.1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#read-and-write-api-security-provisions">5.2.</a>&nbsp;
Read and write API security provisions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#introduction-1">5.2.1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#authorization-server">5.2.2.</a>&nbsp;
Authorization server<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#public-client">5.2.3.</a>&nbsp;
Public client<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#confidential-client">5.2.4.</a>&nbsp;
Confidential client<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#jwt-secured-authorization-response-mode">5.2.5.</a>&nbsp;
JWT Secured Authorization Response Mode<br />
<a href="#accessing-protected-resources-using-tokens">6.</a>&nbsp;
Accessing protected resources (using tokens)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#introduction-2">6.1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#read-and-write-access-provisions">6.2.</a>&nbsp;
Read and write access provisions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#protected-resources-provisions">6.2.1.</a>&nbsp;
Protected resources provisions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#client-provisions">6.2.2.</a>&nbsp;
Client provisions<br />
<a href="#request-object-endpoint">7.</a>&nbsp;
Request object endpoint<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#introduction-3">7.1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#request">7.2.</a>&nbsp;
Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#successful-response">7.3.</a>&nbsp;
Successful response<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#error-responses">7.4.</a>&nbsp;
Error responses<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#authorization-required">7.4.1.</a>&nbsp;
Authorization required<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#invalid-request">7.4.2.</a>&nbsp;
Invalid request<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#method-not-allowed">7.4.3.</a>&nbsp;
Method not allowed<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#request-entity-too-large">7.4.4.</a>&nbsp;
Request entity too large<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#too-many-requests">7.4.5.</a>&nbsp;
Too many requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#openid-provider-discovery-metadata">7.5.</a>&nbsp;
OpenID Provider Discovery Metadata<br />
<a href="#security-considerations">8.</a>&nbsp;
Security considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#introduction-4">8.1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#uncertainty-of-resource-server-handling-of-access-tokens">8.2.</a>&nbsp;
Uncertainty of resource server handling of access tokens<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#attacks-using-weak-binding-of-authorization-server-endpoints">8.3.</a>&nbsp;
Attacks using weak binding of authorization server endpoints<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#introduction-5">8.3.1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#client-credential-and-authorization-code-phishing-at-token-endpoint">8.3.2.</a>&nbsp;
Client credential and authorization code phishing at token endpoint<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#identity-provider-idp-mix-up-attack">8.3.3.</a>&nbsp;
Identity provider (IdP) mix-up attack<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#request-object-endpoint-phishing-resistance">8.3.4.</a>&nbsp;
Request object endpoint phishing resistance<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#access-token-phishing">8.3.5.</a>&nbsp;
Access token phishing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#attacks-that-modify-authorization-requests-and-responses">8.4.</a>&nbsp;
Attacks that modify authorization requests and responses<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#introduction-6">8.4.1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#authorization-request-parameter-injection-attack">8.4.2.</a>&nbsp;
Authorization request parameter injection attack<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#authorization-response-parameter-injection-attack">8.4.3.</a>&nbsp;
Authorization response parameter injection attack<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tls-considerations">8.5.</a>&nbsp;
TLS considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#jws-algorithm-considerations">8.6.</a>&nbsp;
JWS algorithm considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#incomplete-or-incorrect-implementations-of-the-specifications">8.7.</a>&nbsp;
Incomplete or incorrect implementations of the specifications<br />
<a href="#privacy-considerations">9.</a>&nbsp;
Privacy considerations<br />
<a href="#acknowledgement">10.</a>&nbsp;
Acknowledgement<br />
<a href="#bibliography">11.</a>&nbsp;
Bibliography<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="scope"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Scope</h3>

<p>This part of the document specifies the method of 
</p>
<p></p>
<ul class="text">
<li>applications to obtain the OAuth tokens in an appropriately secure manner for higher risk access to data; 
</li>
<li>applications to use OpenID Connect to identify the customer; and 
</li>
<li>using tokens to interact with the REST endpoints that provides protected data; 
</li>
</ul>

<p>This document is applicable to higher risk use cases which includes commercial and investment banking and other similar industries.  
</p>
<a name="normative-references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Normative references</h3>

<p>The following referenced documents are indispensable for the application of this document. For dated references, only the edition cited applied. For undated references, the latest edition of the referenced document (including any amendments) applies.  
</p>
<p>[ISODIR2] - ISO/IEC Directives Part 2 [ISODIR2]: http://www.iso.org/sites/directives/2016/part2/index.xhtml 
</p>
<p>[RFC6749] - The OAuth 2.0 Authorization Framework [RFC6749]: https://tools.ietf.org/html/rfc6749 
</p>
<p>[RFC6750] - The OAuth 2.0 Authorization Framework: Bearer Token Usage [RFC6750]: https://tools.ietf.org/html/rfc6750 
</p>
<p>[RFC7636] - Proof Key for Code Exchange by OAuth Public Clients [RFC7636]: https://tools.ietf.org/html/rfc7636 
</p>
<p>[RFC6819] - OAuth 2.0 Threat Model and Security Considerations [RFC6819]: https://tools.ietf.org/html/rfc6819 
</p>
<p>[RFC7519] - JSON Web Token (JWT) [RFC7519]:https://tools.ietf.org/html/rfc7519 
</p>
<p>[OIDC] - OpenID Connect Core 1.0 incorporating errata set 1 [OIDC]: http://openid.net/specs/openid-connect-core-1_0.html 
</p>
<p>[OIDD] - OpenID Connect Discovery 1.0 incorporating errata set 1 [OIDD]: http://openid.net/specs/openid-connect-discovery-1_0.html 
</p>
<p>[OAUTB] - OAuth 2.0 Token Binding [OAUTB]: https://tools.ietf.org/html/draft-ietf-oauth-token-binding 
</p>
<p>[MTLS] - OAuth 2.0 Mutual TLS Client Authentication and Certificate Bound Access Tokens [MTLS]: https://tools.ietf.org/html/draft-ietf-oauth-mtls 
</p>
<p>[JARM] - Financial Services &#8211; Financial-grade API: JWT Secured Authorization Response Mode for OAuth 2.0 (JARM) [JARM]: https://bitbucket.org/openid/fapi/src/master/Financial_API_JWT_Secured_Authorization_Response_Mode.md 
</p>
<a name="terms-and-definitions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Terms and definitions</h3>

<p>For the purpose of this document, the terms defined in [RFC6749], [RFC6750], [RFC7636], [OpenID Connect Core][OIDC] apply.  
</p>
<a name="symbols-and-abbreviated-terms"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Symbols and Abbreviated terms</h3>

<p><strong>API</strong> &#8211; Application Programming Interface 
</p>
<p><strong>CSRF</strong> - Cross Site Request Forgery 
</p>
<p><strong>FAPI</strong> - Financial API 
</p>
<p><strong>HTTP</strong> &#8211; Hyper Text Transfer Protocol 
</p>
<p><strong>OIDF</strong> - OpenID Foundation 
</p>
<p><strong>REST</strong> &#8211; Representational State Transfer 
</p>
<p><strong>TLS</strong> &#8211; Transport Layer Security 
</p>
<a name="read-and-write-api-security-profile"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Read and write API security profile</h3>

<a name="introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Introduction</h3>

<p>The OIDF Financial-grade API (FAPI) is a REST API that provides JSON data representing higher risk data. These APIs are protected by the OAuth 2.0 Authorization Framework that consists of [RFC6749], [RFC6750], [RFC7636], and other specifications.  
</p>
<p>There are different levels of risks associated with access to these APIs. For example, read and write access to a bank API has a higher financial risk than read-only access. As such, the security profiles of the authorization framework protecting these APIs are also different.  
</p>
<p>This profile describes security provisions for the server and client that are appropriate for Financial-grade APIs by defining the measures to mitigate: 
</p>
<p></p>
<ul class="text">
<li>attacks that leverage the weak binding of endpoints in [RFC6749] (e.g. malicious endpoint attacks, IdP mix-up attacks), 
</li>
<li>attacks that modify authorization requests and responses unprotected in [RFC6749] by leveraging OpenID Connect's Hybrid Flow that returns an ID Token in the authorization response.  
</li>
</ul>

<p>While the name ID Token suggests that it is something that provides the identity of the resource owner (subject), it is not necessarily so. While it does identify the authorization server by including the issuer identifier, it is perfectly fine to have an ephemeral subject identifier. In this case, the ID Token acts as a detached signature of the issuer to the authorization response and it was an explicit design decision of OpenID Connect Core to make the ID Token act as a detached signature.  
</p>
<p>This document leverages this fact and protects the authorization response by including the hash of all of the unprotected response parameters, e.g. <tt>code</tt> and <tt>state</tt>.  
</p>
<p>While the hash of the <tt>code</tt> is defined in [OIDC], the hash of the <tt>state</tt> is not defined.  Thus this document defines it as follows.  
</p>
<p><strong>s_hash</strong> 
</p>
<p></p>
<blockquote class="text">
<p>State hash value. Its value is the base64url encoding of the left-most half of the hash of the octets of the ASCII representation of the <tt>state</tt> value, where the hash algorithm used is the hash algorithm used in the <tt>alg</tt> header parameter of the ID Token's JOSE header. For instance, if the <tt>alg</tt> is <tt>HS512</tt>, hash the state value with SHA-512, then take the left-most 256 bits and base64url encode them. The <tt>s_hash</tt> value is a case sensitive string.  
</p>
</blockquote>

<a name="read-and-write-api-security-provisions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Read and write API security provisions</h3>

<a name="introduction-1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
Introduction</h3>

<p>Read and write access carries higher risk; therefore the protection level required is higher than read-only access.  
</p>
<p>As a profile of The OAuth 2.0 Authorization Framework, this document mandates the following for the read and write API of the FAPI.  
</p>
<a name="authorization-server"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2"></a><h3>5.2.2.&nbsp;
Authorization server</h3>

<p>The authorization server shall support the provisions specified in clause 5.2.2 of Financial-grade API - Part 1: Read-Only API Security Profile.  
</p>
<p>In addition, the authorization server, for the write operation, 
</p>
<p></p>
<ol class="text">
<li>shall require the <tt>request</tt> or <tt>request_uri</tt> parameter to be passed as a JWS signed JWT as in clause 6 of [OIDC]; 
</li>
<li>shall require the <tt>response_type</tt> values <tt>code id_token</tt> or <tt>code id_token token</tt>; 
</li>
<li>shall return ID Token as a detached signature to the authorization response; 
</li>
<li>shall include state hash, <tt>s_hash</tt>, in the ID Token to protect the <tt>state</tt> value if the client supplied a value for <tt>state</tt>.  <tt>s_hash</tt> may be omitted from the ID Token returned from the Token Endpoint when <tt>s_hash</tt> is present in the ID Token returned from the Authorization Endpoint; 
</li>
<li>shall only issue authorization code, access token, and refresh token that are holder of key bound; 
</li>
<li>shall support [OAUTB] or [MTLS] as a holder of key mechanism; 
</li>
<li>shall support user authentication at LoA 3 or greater as defined in [X.1254]; 
</li>
<li>shall support signed ID Tokens; 
</li>
<li>should support signed and encrypted ID Token; 
</li>
<li>shall require that all parameters are present inside the signed request object passed in the <tt>request</tt> or <tt>request_uri</tt> parameter; 
</li>
<li>may support the request object endpoint as described in section 7; 
</li>
<li>shall require [RFC7636] with S256 as the code challenge method for public clients only, if it supports public clients; 
</li>
<li>shall require the request object to contain an <tt>exp</tt> claim; and 
</li>
<li>shall authenticate the confidential client at the token endpoint using one of the following methods (this overrides FAPI part 1 clause 5.2.2.4): 
<ol class="text">
<li>Mutual TLS for OAuth Client Authentication as specified in section 2 of [MTLS]; 
</li>
<li><tt>private_key_jwt</tt> as specified in section 9 of [OIDC]; 
</li>
</ol> 
</li>
</ol>

<a name="public-client"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.3"></a><h3>5.2.3.&nbsp;
Public client</h3>

<p>A public client shall support the provisions specified in clause 5.2.3 of Financial-grade API - Part 1: Read-Only API Security Profile.  
</p>
<p>In addition, the public client for write operations 
</p>
<p></p>
<ol class="text">
<li>shall support [OAUTB] or [MTLS] as a holder of key mechanism; Note: [MTLS] shall be used with instance-specific keys and (self-signed) certificates to bind access tokens to the particular instance of a public client. It is NOT used as client authentication mechanisms.  
</li>
<li>shall include the <tt>request</tt> or <tt>request_uri</tt> parameter as defined in Section 6 of [OIDC] in the authentication request; 
</li>
<li>shall request user authentication at LoA 3 or greater by requesting the <tt>acr</tt> claim as an essential claim as defined in section 5.5.1.1 of [OIDC]; 
</li>
<li>shall require JWS signed ID Token be returned from endpoints; 
</li>
<li>shall verify that the <tt>acr</tt> claim in an ID Token indicates that user authentication was performed at LoA3 or greater; 
</li>
<li>shall verify that the <tt>amr</tt> claim in an ID Token contains values appropriate for the LoA indicated by the <tt>acr</tt> claim; 
</li>
<li>shall verify that the authorization response was not tampered using ID Token as the detached signature 
</li>
<li>shall send all parameters inside the authorization request's signed request object 
</li>
<li>shall additionally send duplicates of the parameters/values using the OAuth 2.0 request syntax where required by the OAuth specification 
</li>
</ol>

<p>To verify that the authorization response was not tampered using ID Token as the detached signature, the client shall verify that <tt>s_hash</tt> value is equal to the value calculated from the <tt>state</tt> value in the authorization response in addition to all the requirements in 3.3.2.12 of [OIDC].  
</p>
<a name="confidential-client"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.4"></a><h3>5.2.4.&nbsp;
Confidential client</h3>

<p>In addition to the provisions for the public client in clause 5.2.3 of this document, except for [RFC7636] support, the confidential client for write operations 
</p>
<p></p>
<ol class="text">
<li>shall support [OAUTB] or [MTLS] as a holder of key mechanism (this overrides clause 5.2.3.1); Note: In case of confidential clients, [MTLS] can also be used as client authentication mechanism.  
</li>
<li>should require both JWS signed and JWE encrypted ID Tokens to be returned from endpoints to protect any sensitive personally identifiable information (PII) contained in the ID Token provided as a detached signature in the authorization response 
</li>
</ol>

<a name="jwt-secured-authorization-response-mode"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.5"></a><h3>5.2.5.&nbsp;
JWT Secured Authorization Response Mode</h3>

<p>In addition to the provisions given in section 5.2.2, an authorization server may protect authorization responses to clients using the "JWT Secured Authorization Response Mode" [JARM].  
</p>
<p>The [JARM] allows a client to request that an authorization server encode the authorization response (of any response type) in a JWT. It is an alternative to utilizing ID Tokens as detached signatures for providing financial-grade security on authorization responses.  
</p>
<p>The authorization server should advertise support for the [JARM] response modes using the <tt>response_modes_supported</tt> metadata parameter.  
</p>
<p>If [JARM] is used to secure the authorization responses, the clauses 2, 3, and 4 of section 5.2.2. do not apply. For example, clients may use [JARM] in conjunction with the response type <tt>code</tt>.  
</p>
<a name="accessing-protected-resources-using-tokens"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Accessing protected resources (using tokens)</h3>

<a name="introduction-2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Introduction</h3>

<p>The FAPI endpoints are OAuth 2.0 protected resource endpoints that return protected information for the resource owner associated with the submitted access token.  
</p>
<a name="read-and-write-access-provisions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Read and write access provisions</h3>

<a name="protected-resources-provisions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.1"></a><h3>6.2.1.&nbsp;
Protected resources provisions</h3>

<p>The protected resources supporting this document 
</p>
<p></p>
<ol class="text">
<li>shall support the provisions specified in clause 6.2.1 Financial-grade API - Part 1: Read Only API Security Profile; 
</li>
<li>shall adhere to the requirements in [MTLS] or [OAUTB].  
</li>
</ol>

<a name="client-provisions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.2"></a><h3>6.2.2.&nbsp;
Client provisions</h3>

<p>The client supporting this document shall support the provisions specified in clause 6.2.2 of Financial-grade API - Part 1: Read-Only API Security Profile.  
</p>
<a name="request-object-endpoint"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Request object endpoint</h3>

<a name="introduction-3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Introduction</h3>

<p>The client may not want to send the request object by value, either because it is too large, or because it contains sensitive data and the client does not want to encrypt the request object.  In such cases it is possible to send the request object by reference using a <tt>request_uri</tt>.  
</p>
<p>Note that <tt>request_uri</tt> can be either URL or URN.  
</p>
<p>Although the request URI could be hosted by the client, within the FAPI spec it is hosted by the authorization server. The advantage of the authorization server hosting the request object is that it does not have to support outbound requests to a client specified request URI nor rely on the entropy of the URI for the confidentiality of the request object.  
</p>
<p>When the request object is stored at the authorization server, the <tt>request_uri</tt> value typically is a URN.  
</p>
<p>This section defines the methods for the authorization server's request object endpoint to exchange a request object for a request URI.  
</p>
<a name="request"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Request</h3>

<p></p>
<ol class="text">
<li>The request object endpoint shall be a RESTful API at the authorization server that accepts a signed request object as an HTTPS POST payload.  
</li>
<li>The request object shall be signed for client authentication and as evidence of the client submitting the request object, which is referred to as 'non-repudiation'.  
</li>
</ol>

<p>The following is an example of such a request: 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
POST https://as.example.com/ros/ HTTP/1.1
Host: as.example.com
Content-Type: application/jws
Content-Length: 1288

eyJhbGciOiJSUzI1NiIsImtpZCI6ImsyYmRjIn0.ew0KICJpc3MiOiA
(... abbreviated for brevity ...)
zCYIb_NMXvtTIVc1jpspnTSD7xMbpL-2QgwUsAlMGzw
</pre></div>
<a name="successful-response"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Successful response</h3>

<p></p>
<ol class="text">
<li>The authorization server shall verify that the request object is valid, the signature algorithm is not <tt>none</tt>, and the signature is correct as in clause 6.3 of [OIDC].  
</li>
<li>If the verification is successful, the server shall generate a request URI and return a JSON payload that contains <tt>request_uri</tt>, <tt>aud</tt>, <tt>iss</tt>, and <tt>exp</tt> claims at the top level with <tt>201 Created</tt> HTTP response code.  
</li>
<li>The <tt>request_uri</tt> shall be based on a cryptographic random value so that it is difficult to predict for an attacker.  
</li>
<li>The request URI shall be bound to the client identifier of the client that posted the request object.  
</li>
<li>Since the request URI can be replayed, its lifetime should be short and preferably limited to one-time use.  
</li>
<li>The value of these claims in the JSON payload shall be as follows: 
<ul class="text">
<li><tt>request_uri</tt> : The request URI corresponding to the request object posted.  
</li>
<li><tt>aud</tt> : A JSON string that represents the client identifier of the client that posted the request object.  
</li>
<li><tt>iss</tt> : A JSON string that represents the issuer identifier of the authorization server as defined in [RFC7519]. When a pure OAuth 2.0 is used, the value is the redirection URI. When OpenID Connect is used, the value is the issuer value of the authorization server.  
</li>
<li><tt>exp</tt> : A JSON number that represents the expiry time of the request URI as defined in [RFC7519].  
</li>
</ul> 
</li>
</ol>

<p>The following is an example of such a response: 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 201 Created
Date: Tue, 2 May 2017 15:22:31 GMT
Content-Type: application/json

{
    "iss": "https://as.example.com/",
    "aud": "s6BhdRkqt3",
    "request_uri": "urn:example:MTAyODAK",
    "exp": 1493738581
}
</pre></div>
<a name="error-responses"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
Error responses</h3>

<a name="authorization-required"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.1"></a><h3>7.4.1.&nbsp;
Authorization required</h3>

<p>If the signature validation fails, the authorization server shall return <tt>401 Unauthorized</tt> HTTP error response.  
</p>
<a name="invalid-request"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.2"></a><h3>7.4.2.&nbsp;
Invalid request</h3>

<p>If the request object received is invalid, the authorization server shall return <tt>400 Bad Request</tt> HTTP error response.  
</p>
<a name="method-not-allowed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.3"></a><h3>7.4.3.&nbsp;
Method not allowed</h3>

<p>If the request did not use POST, the authorization server shall return <tt>405 Method Not Allowed</tt> HTTP error response.  
</p>
<a name="request-entity-too-large"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.4"></a><h3>7.4.4.&nbsp;
Request entity too large</h3>

<p>If the request size was beyond the upper bound that the authorization server allows, the authorization server shall return a <tt>413 Request Entity Too Large</tt> HTTP error response.  
</p>
<a name="too-many-requests"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.5"></a><h3>7.4.5.&nbsp;
Too many requests</h3>

<p>If the request from the client per a time period goes beyond the number the authorization server allows, the authorization server shall return a <tt>429 Too Many Requests</tt> HTTP error response.  
</p>
<a name="openid-provider-discovery-metadata"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5"></a><h3>7.5.&nbsp;
OpenID Provider Discovery Metadata</h3>

<p>If the authorization server has a request object endpoint and supports [OIDD], it shall include the following OpenID Provider Metadata parameter in discovery responses: 
</p>
<p></p>
<ol class="text">
<li><tt>request_object_endpoint</tt> : The url of the request object endpoint at which the client can exchange a request object for a request URI.  
</li>
</ol>

<a name="security-considerations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security considerations</h3>

<a name="introduction-4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Introduction</h3>

<p>As a profile of the OAuth 2.0 Authorization Framework, this specification references the security considerations defined in section 10 of [RFC6749], as well as [RFC6819] - OAuth 2.0 Threat Model and Security Considerations, which details various threats and mitigations.  
</p>
<a name="uncertainty-of-resource-server-handling-of-access-tokens"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Uncertainty of resource server handling of access tokens</h3>

<p>There is no way that the client can find out whether the resource access was granted for the bearer token or holder of key token.  The two differ in the risk profile and the client may want to differentiate them. The protected resources that conforms to this document shall not accept a plain bearer token. They shall only support token bound access tokens via [MTLS] or [OAUTB].  
</p>
<a name="attacks-using-weak-binding-of-authorization-server-endpoints"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
Attacks using weak binding of authorization server endpoints</h3>

<a name="introduction-5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3.1"></a><h3>8.3.1.&nbsp;
Introduction</h3>

<p>In [RFC6749] and [RFC6750], the endpoints that the authorization server offers are not tightly bound together. There is no notion of authorization server identifier (issuer identifier) and it is not indicated in the authorization response unless the client uses different redirection URI per authorization server. While it is assumed in the OAuth model, it is not explicitly spelled out and thus many clients use the same redirection URI for different authorization servers exposing an attack surface.  Several attacks have been identified and the threats are explained in detail in [RFC6819].  
</p>
<a name="client-credential-and-authorization-code-phishing-at-token-endpoint"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3.2"></a><h3>8.3.2.&nbsp;
Client credential and authorization code phishing at token endpoint</h3>

<p>In this attack, the client developer is social engineered into believing that the token endpoint has changed to the URL that is controlled by the attacker. As the result, the client sends the <tt>code</tt> and the client secret to the attacker, which will be replayed subsequently.  
</p>
<p>When the FAPI client uses [MTLS] or [OAUTB], the authorization code is bound to the TLS channel, any phished client credentials and authorization codes submitted to the token endpoint cannot be used since the authorization code is bound to a particular TLS channel.  
</p>
<a name="identity-provider-idp-mix-up-attack"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3.3"></a><h3>8.3.3.&nbsp;
Identity provider (IdP) mix-up attack</h3>

<p>In this attack, the client has registered multiple IdPs and one of them is a rogue IdP that returns the same <tt>client_id</tt> that belongs to one of the honest IdPs. When a user clicks on a malicious link or visits a compromised site, an authorization request is sent to the rogue IdP. The rogue IdP then redirects the client to the honest IdP that has the same <tt>client_id</tt>. If the user is already logged on at the honest IdP, then the authentication may be skipped and a code is generated and returned to the client.  Since the client was interacting with the rogue IdP, the code is sent to the rogue IdP's token endpoint. At the point, the attacker has a valid code that can be exchanged for an access token at the honest IdP.  
</p>
<p>This is mitigated by the use of OpenID Connect Hybrid Flow in which the honest IdP's issuer identifier is included as the value of <tt>iss</tt>. The client then sends the <tt>code</tt> to the token endpoint that is associated with the issuer identifier thus it will not get to the attacker.  
</p>
<a name="request-object-endpoint-phishing-resistance"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3.4"></a><h3>8.3.4.&nbsp;
Request object endpoint phishing resistance</h3>

<p>An attacker can use social engineering to have the administrator of the client set the request object endpoint to a URL under the attacker's control. In this case, sensitive information included in the request object will be revealed to the attacker. To prevent this, the authorization server should communicate to the client developer the proper change process repeatedly to help client developers to be less susceptible to such social engineering.  
</p>
<a name="access-token-phishing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3.5"></a><h3>8.3.5.&nbsp;
Access token phishing</h3>

<p>When the FAPI client uses [MTLS] or [OAUTB], the access token is bound to the TLS channel, it is access token phishing resistant as the phished access tokens cannot be used.  
</p>
<a name="attacks-that-modify-authorization-requests-and-responses"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4"></a><h3>8.4.&nbsp;
Attacks that modify authorization requests and responses</h3>

<a name="introduction-6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4.1"></a><h3>8.4.1.&nbsp;
Introduction</h3>

<p>In [RFC6749] the authorization request and responses are not integrity protected. Thus, an attacker can modify them.  
</p>
<a name="authorization-request-parameter-injection-attack"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4.2"></a><h3>8.4.2.&nbsp;
Authorization request parameter injection attack</h3>

<p>In [RFC6749], the authorization request is sent as query parameter. Although [RFC6749] mandates the use of TLS, the TLS is terminated in the browser and thus not protected within the browser; as a result an attacker can tamper the authorization request and insert any parameter values.  
</p>
<p>The use of a <tt>request</tt> object or <tt>request_uri</tt> in the authorization request will prevent tampering with the request parameters.  
</p>
<p>The IdP confusion attack reported in <a href='https://www.nds.rub.de/media/ei/veroeffentlichungen/2017/01/30/oidc-security.pdf'>SoK: Single Sign-On Security &#8211; An Evaluation of OpenID Connect</a> is an example of this kind of attack.  
</p>
<a name="authorization-response-parameter-injection-attack"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4.3"></a><h3>8.4.3.&nbsp;
Authorization response parameter injection attack</h3>

<p>This attack occurs when the victim and attacker use the same relying party client. The attacker is somehow able to capture the authorization code and state from the victim's authorization response and uses them in his own authorization response.  
</p>
<p>This can be mitigated by using OpenID Connect Hybrid Flow where the <tt>c_hash</tt>, <tt>at_hash</tt>, and <tt>s_hash</tt> can be used to verify the validity of the authorization code, access token, and state parameters. The server can verify that the state is the same as what was stored in the browser session at the time of the authorization request.  
</p>
<a name="tls-considerations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5"></a><h3>8.5.&nbsp;
TLS considerations</h3>

<p>As confidential information is being exchanged, all interactions shall be encrypted with TLS (HTTPS).  
</p>
<p>Section 7.1 of Financial-grade API - Part 1: Read Only API Security Profile shall apply, with the following additional requirements: 
</p>
<p></p>
<ol class="text">
<li>Only the following 4 cipher suites shall be permitted: 
<ul class="text">
<li><tt>TLS_DHE_RSA_WITH_AES_128_GCM_SHA256</tt> 
</li>
<li><tt>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</tt> 
</li>
<li><tt>TLS_DHE_RSA_WITH_AES_256_GCM_SHA384</tt> 
</li>
<li><tt>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</tt> 
</li>
</ul> 
</li>
<li>For the <tt>authorization_endpoint</tt>, the authorisation server MAY allow additional cipher suites that are permitted by the latest version of [BCP195], if necessary to allow sufficient interoperability with users' web browsers.  
</li>
</ol>

<a name="jws-algorithm-considerations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.6"></a><h3>8.6.&nbsp;
JWS algorithm considerations</h3>

<p>Both clients and authorisation servers: 
</p>
<p></p>
<ol class="text">
<li>shall use <tt>PS256</tt> or <tt>ES256</tt> algorithms; 
</li>
<li>should not use algorithms that use RSASSA-PKCS1-v1_5 (e.g.  <tt>RS256</tt>); 
</li>
<li>shall not use <tt>none</tt>; 
</li>
</ol>

<a name="incomplete-or-incorrect-implementations-of-the-specifications"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.7"></a><h3>8.7.&nbsp;
Incomplete or incorrect implementations of the specifications</h3>

<p>To achieve the full security benefits, it is important the implementation of this specification, and the underlying OpenID Connect and OAuth specifications, are both complete and correct.  
</p>
<p>The OpenID Foundation provides tools that can be used to confirm that an implementation is correct: 
</p>
<p>https://openid.net/certification/ 
</p>
<p>The OpenID Foundation maintains a list of certified implementations: 
</p>
<p>https://openid.net/developers/certified/ 
</p>
<p>Deployments that use this specification should use a certified implementation.  
</p>
<a name="privacy-considerations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Privacy considerations</h3>

<p></p>
<ul class="text">
<li>If the client is to be used by a single user, the client certificate will provide the means for the websites that belong to different administrative domains to collude and correlate the user's access. For this reason, public clients that reside on a user's terminal should avoid [MTLS] and use [OAUTB] instead.  
</li>
<li>When claims related to the subject are returned in the ID Token in the front channel, implementations should consider encrypting the ID Token to lower the risk of personal information disclosure.  
</li>
</ul>

<a name="acknowledgement"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Acknowledgement</h3>

<p>The following people contributed to this document: 
</p>
<p></p>
<ul class="text">
<li>Nat Sakimura (Nomura Research Institute) -- Chair, Editor 
</li>
<li>Anoop Saxana (Intuit) -- Co-chair, FS-ISAC Liaison 
</li>
<li>Anthony Nadalin (Microsoft) -- Co-chair, SC 27 Liaison 
</li>
<li>Edmund Jay (Illumila) -- Co-editor 
</li>
<li>Dave Tonge (Moneyhub) -- Co-chair, UK Implementation Entity Liaison 
</li>
<li>Paul A. Grassi (NIST) -- X9 Liaison 
</li>
<li>Joseph Heenan (Authlete) 
</li>
<li>Sascha H. Preibisch (CA) 
</li>
<li>John Bradley (Yubico) 
</li>
<li>Henrik Biering (Peercraft) 
</li>
<li>Tom Jones (Independent) 
</li>
<li>Axel Nennker (Deutsche Telekom) 
</li>
<li>Torsten Lodderstedt (YES) 
</li>
<li>Ralph Bragg (Raidiam) 
</li>
<li>Brian Campbell (Ping Identity) 
</li>
</ul>

<a name="bibliography"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Bibliography</h3>

<p></p>
<ul class="text">
<li>[ISODIR2] ISO/IEC Directives Part 2 
</li>
<li>[RFC6749] The OAuth 2.0 Authorization Framework 
</li>
<li>[RFC6750] The OAuth 2.0 Authorization Framework: Bearer Token Usage 
</li>
<li>[RFC7636] Proof Key for Code Exchange by OAuth Public Clients 
</li>
<li>[RFC6819] OAuth 2.0 Threat Model and Security Considerations 
</li>
<li>[RFC7519] JSON Web Token (JWT) 
</li>
<li>[OIDC] OpenID Connect Core 1.0 incorporating errata set 1 
</li>
<li>[OIDD] OpenID Connect Discovery 1.0 incorporating errata set 1 
</li>
<li>[OAUTB] OAuth 2.0 Token Binding 
</li>
<li>[MTLS] OAuth 2.0 Mutual TLS Client Authentication and Certificate Bound Access Tokens 
</li>
<li>[JARM] Financial Services &#8211; Financial-grade API: JWT Secured Authorization Response Mode for OAuth 2.0 
</li>
<li>[SoK] Mainka, C., Mladenov, V., Schwenk, J., and T. Wich: SoK: Single Sign-On Security &#8211; An Evaluation of OpenID Connect 
</li>
</ul>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nat Sakimura</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nomura Research Institute, Ltd.</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:n-sakimura@nri.co.jp">n-sakimura@nri.co.jp</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://nat.sakimura.org/">http://nat.sakimura.org/</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">John Bradley</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Yubico</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ve7jtb@ve7jtb.com">ve7jtb@ve7jtb.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.thread-safe.com/">http://www.thread-safe.com/</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Edmund Jay</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Illumila</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ejay@mgi1.com">ejay@mgi1.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://illumi.la/">http://illumi.la/</a></td></tr>
</table>
</body></html>
